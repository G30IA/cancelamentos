<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Lean Six Sigma: An√°lise de Churn</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.0/dist/chartjs-plugin-annotation.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #e74c3c;
            --accent-color: #3498db;
            --bg-color: #ecf0f1;
            --card-bg: #ffffff;
            --text-color: #34495e;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 { margin: 0; font-size: 2.5rem; }
        .header p { margin: 5px 0 0; opacity: 0.9; }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .full-width { grid-column: 1 / -1; }

        h2 {
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
            margin-top: 0;
            font-size: 1.2rem;
            color: var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .metric-box {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }

        .metric {
            text-align: center;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--secondary-color);
        }

        .metric-label {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .sigma-badge {
            background-color: #27ae60;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* Ishikawa Style */
        .ishikawa-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            position: relative;
        }
        
        .fish-bone {
            width: 48%;
            margin-bottom: 15px;
            border-left: 3px solid var(--accent-color);
            padding-left: 10px;
        }

        .fish-bone h3 { margin: 0 0 5px 0; color: var(--primary-color); font-size: 1rem; }
        .fish-bone ul { margin: 0; padding-left: 20px; font-size: 0.9rem; color: #555; }

        /* DMAIC Steps */
        .dmaic-steps {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        .step {
            flex: 1;
            text-align: center;
            background: #eee;
            margin: 0 5px;
            padding: 10px;
            border-radius: 4px;
            font-size: 0.85rem;
        }
        .step.active { background: var(--accent-color); color: white; font-weight: bold; }

    </style>
</head>
<body>

    <div class="header">
        <h1>Dashboard Forense de Churn</h1>
        <p>Metodologia Lean Six Sigma | Jan-Fev 2026</p>
    </div>

    <div class="card full-width" style="margin-bottom: 20px;">
        <div class="dmaic-steps">
            <div class="step">1. DEFINE (Definir)</div>
            <div class="step">2. MEASURE (Medir)</div>
            <div class="step active">3. ANALYZE (Analisar)</div>
            <div class="step">4. IMPROVE (Melhorar)</div>
            <div class="step">5. CONTROL (Controlar)</div>
        </div>
    </div>

    <div class="dashboard-grid">
        
        <!-- Metrics -->
        <div class="card">
            <h2>Estat√≠stica do Processo <span id="sigmaBadge" class="sigma-badge">Calculando...</span></h2>
            <div class="metric-box">
                <div class="metric">
                    <div class="metric-value" id="totalDefects">0</div>
                    <div class="metric-label">Total de Defeitos (Churn)</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="meanValue">0.0</div>
                    <div class="metric-label">M√©dia Semanal ($\bar{x}$)</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="stdDevValue">0.0</div>
                    <div class="metric-label">Desvio Padr√£o ($\sigma$)</div>
                </div>
            </div>
            <p style="font-size: 0.9rem; color: #666;" id="analysisText">
                <strong>An√°lise:</strong> Calculando estat√≠sticas...
            </p>
        </div>

        <!-- Control Chart -->
        <div class="card">
            <h2>Carta de Controle (Estabilidade 3$\sigma$)</h2>
            <canvas id="controlChart"></canvas>
        </div>

        <!-- Pareto Chart -->
        <div class="card">
            <h2>Diagrama de Pareto (Causas Raiz)</h2>
            <canvas id="paretoChart"></canvas>
        </div>

        <!-- Ishikawa Diagram -->
        <div class="card">
            <h2>Diagrama de Ishikawa (Causa e Efeito)</h2>
            <div class="ishikawa-container">
                <div class="fish-bone">
                    <h3>üõ†Ô∏è M√°quina (Tecnologia)</h3>
                    <ul>
                        <li><strong>Carchat:</strong> Bloqueios de WhatsApp (Car Prime).</li>
                        <li><strong>IA:</strong> Respostas incorretas/"Burrice" (Super Auto).</li>
                        <li><strong>Integra√ß√£o:</strong> Erros de estoque (Pix Motors).</li>
                    </ul>
                </div>
                <div class="fish-bone">
                    <h3>üìã M√©todo (Processo)</h3>
                    <ul>
                        <li><strong>Onboarding:</strong> Padronizado vs. Personalizado (Fast Lane).</li>
                        <li><strong>Venda:</strong> Expectativa de automa√ß√£o total vs. Realidade.</li>
                        <li><strong>Timing:</strong> Implanta√ß√£o durante obras/mudan√ßas (JRK).</li>
                    </ul>
                </div>
                <div class="fish-bone">
                    <h3>üë• M√£o de Obra (Pessoas)</h3>
                    <ul>
                        <li><strong>Lideran√ßa:</strong> Dono ausente/Div√≥rcio (Getar).</li>
                        <li><strong>Equipe:</strong> Resist√™ncia ao CRM/Sabotagem (TG, Elias).</li>
                        <li><strong>Capacidade:</strong> Falta de bra√ßo operacional (Pexe).</li>
                    </ul>
                </div>
                <div class="fish-bone">
                    <h3>üí∞ Meio (Ambiente/Financeiro)</h3>
                    <ul>
                        <li><strong>Insolv√™ncia:</strong> D√≠vidas pr√©vias (JK Ve√≠culos).</li>
                        <li><strong>Mortalidade Infantil:</strong> Loja nova sem caixa (F√™nix).</li>
                        <li><strong>Custo:</strong> Baixo ROI percebido (Mabe Autos).</li>
                    </ul>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- 1. Dados e C√°lculos Estat√≠sticos Din√¢micos ---
        
        const weeks = ['Semana 1', 'Semana 2', 'Semana 3', 'Semana 4', 'Semana 5', 'Semana 6'];
        const churnData = [4, 6, 9, 3, 6, 5]; // Dados reais extra√≠dos dos relat√≥rios
        
        // Fun√ß√µes Auxiliares
        const calculateSum = (arr) => arr.reduce((a, b) => a + b, 0);
        const calculateMean = (arr) => calculateSum(arr) / arr.length;
        
        const calculateStdDev = (arr, mean) => {
            const squareDiffs = arr.map(value => Math.pow(value - mean, 2));
            const avgSquareDiff = calculateSum(squareDiffs) / (arr.length - 1); // Sample Std Dev
            return Math.sqrt(avgSquareDiff);
        };

        // Executando C√°lculos
        const totalDefects = calculateSum(churnData);
        const mean = calculateMean(churnData);
        const stdDev = calculateStdDev(churnData, mean);
        
        // Limites de Controle (Regra 3-Sigma)
        const ucl = mean + (3 * stdDev); // Upper Control Limit
        const lcl = Math.max(0, mean - (3 * stdDev)); // Lower Control Limit (n√£o pode ser negativo)
        const warningLimit = mean + (2 * stdDev); // Limite de alerta

        // --- 2. Atualiza√ß√£o da Interface (DOM) ---
        
        document.getElementById('totalDefects').textContent = totalDefects;
        document.getElementById('meanValue').textContent = mean.toFixed(1);
        document.getElementById('stdDevValue').textContent = stdDev.toFixed(1);

        // An√°lise de Texto Din√¢mica
        const outliers = churnData.filter(v => v > warningLimit).length;
        const analysisText = `
            <strong>Interpreta√ß√£o:</strong> O processo apresenta instabilidade. 
            O desvio padr√£o de <strong>${stdDev.toFixed(1)}</strong> indica varia√ß√£o semanal. 
            A Semana 3 (${churnData[2]} defeitos) superou o limite de alerta (2$\sigma$), 
            indicando uma <strong>Causa Especial</strong> que exige investiga√ß√£o imediata.
        `;
        document.getElementById('analysisText').innerHTML = analysisText;

        // Badge de N√≠vel
        const sigmaBadge = document.getElementById('sigmaBadge');
        if (stdDev > 2) {
            sigmaBadge.style.backgroundColor = '#e74c3c'; // Red
            sigmaBadge.textContent = 'Processo Inst√°vel';
        } else {
            sigmaBadge.style.backgroundColor = '#f39c12'; // Orange
            sigmaBadge.textContent = 'N√≠vel Sigma Baixo';
        }

        // --- 3. Gr√°ficos ---

        // Control Chart
        const ctxControl = document.getElementById('controlChart').getContext('2d');
        new Chart(ctxControl, {
            type: 'line',
            data: {
                labels: weeks,
                datasets: [
                    {
                        label: 'Cancelamentos (Defeitos)',
                        data: churnData,
                        borderColor: '#2c3e50',
                        backgroundColor: 'rgba(44, 62, 80, 0.1)',
                        tension: 0.1,
                        pointRadius: 6,
                        pointBackgroundColor: churnData.map(v => v >= warningLimit ? '#e74c3c' : '#2c3e50')
                    },
                    {
                        label: 'M√©dia',
                        data: Array(6).fill(mean),
                        borderColor: '#27ae60',
                        borderDash: [5, 5],
                        pointRadius: 0,
                        borderWidth: 2
                    },
                    {
                        label: 'UCL (3$\sigma$)',
                        data: Array(6).fill(ucl),
                        borderColor: '#c0392b',
                        borderDash: [2, 2],
                        pointRadius: 0,
                        borderWidth: 1,
                        fill: false
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'bottom' },
                    annotation: {
                        annotations: {
                            line1: {
                                type: 'line',
                                yMin: warningLimit,
                                yMax: warningLimit,
                                borderColor: 'orange',
                                borderWidth: 1,
                                borderDash: [4, 4],
                                label: {
                                    content: 'Alerta 2œÉ',
                                    display: true,
                                    position: 'start'
                                }
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            afterLabel: function(context) {
                                return context.raw >= warningLimit ? '‚ö† Causa Especial Detectada' : '';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'Qtd. Cancelamentos' },
                        suggestedMax: ucl + 1
                    }
                }
            }
        });

        // Pareto Chart
        const paretoData = [12, 9, 7, 5]; // Frequ√™ncia
        const paretoLabels = ['Falha T√©cnica/Produto', 'Expectativa/Metodologia', 'Financeiro/Custo', 'Equipe/Gest√£o'];
        
        // Calculando acumulado dinamicamente
        let cumulativeSum = 0;
        const totalPareto = calculateSum(paretoData);
        const paretoPercentage = paretoData.map(val => {
            cumulativeSum += val;
            return (cumulativeSum / totalPareto) * 100;
        });

        const ctxPareto = document.getElementById('paretoChart').getContext('2d');
        new Chart(ctxPareto, {
            type: 'bar',
            data: {
                labels: paretoLabels,
                datasets: [{
                    label: 'Frequ√™ncia',
                    data: paretoData,
                    backgroundColor: [
                        '#e74c3c', // Vital Few (Poucos Vitais)
                        '#f39c12',
                        '#3498db',
                        '#95a5a6'  // Trivial Many (Muitos Triviais)
                    ],
                    order: 1,
                    yAxisID: 'y'
                }, {
                    label: 'Acumulado %',
                    data: paretoPercentage,
                    type: 'line',
                    borderColor: '#2c3e50',
                    borderWidth: 2,
                    pointRadius: 4,
                    yAxisID: 'y1',
                    order: 0
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'bottom' },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'Ocorr√™ncias' }
                    },
                    y1: {
                        beginAtZero: true,
                        position: 'right',
                        max: 100,
                        title: { display: true, text: '%' },
                        grid: { drawOnChartArea: false }
                    }
                }
            }
        });
    </script>
</body>
</html>
